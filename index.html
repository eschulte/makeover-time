<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makeover Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #fce4ec; /* Light pink background */
        }
        .title-font {
            font-family: 'Pacifico', cursive;
        }
        /* Custom scrollbar for a more playful look */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #fde6f0;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #f48fb1; /* Brighter pink */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #f06292;
        }
        /* Custom padding fix */
        .pr-2 {
            padding: 0.5rem;
        }
        /* Style for the active/selected item */
        .wardrobe-item.active, .character-selector.active {
            box-shadow: 0 0 0 4px #ec4899; /* Pink-500 */
            transform: scale(1.05);
        }
        .category-tab.active {
            background-color: #ec4899; /* pink-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Transition for smooth character and clothing changes */
        #character-display > div {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Ensure images fit their containers properly */
        .wardrobe-item img, .character-selector img, #character-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 max-w-7xl">
        <header class="text-center my-6">
            <h1 class="title-font text-5xl md:text-7xl text-pink-500">Makeover Time</h1>
            <p class="text-pink-700 mt-2 text-lg">Choose a character and create the perfect look!</p>
            <div class="mt-4">
                <button id="share-button" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-pink-600 transition-all transform hover:scale-105">
                    ✨ Share Look!
                </button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 flex flex-col items-center">
                <div id="character-selection" class="mb-4 flex gap-3 bg-white/70 p-2 rounded-full shadow-md">
                    </div>
                <div id="character-display-container" class="relative w-64 h-[450px] md:w-80 md:h-[560px] bg-white rounded-3xl shadow-2xl overflow-hidden flex items-center justify-center">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-100 to-purple-100"></div>
                     <div id="character-display" class="relative w-full h-full"></div>
                </div>
            </div>

            <div class="lg:col-span-2 bg-white/80 backdrop-blur-sm p-6 rounded-3xl shadow-lg flex flex-col">
                <div id="category-tabs" class="flex flex-wrap gap-2 border-b-2 border-pink-200 pb-4 mb-4">
                    </div>
                <div id="item-panel" class="flex-grow custom-scrollbar overflow-y-auto pr-2">
                    </div>
            </div>
        </main>
    </div>

    <script>
        // --- IMAGE ASSET GUIDELINES ---
        /*
            To replace the placeholder images, use transparent PNGs with the
            recommended dimensions below. All images should be aligned to the
            same baseline so they layer correctly on the character.

            - Characters: 400px width, 700px height (e.g., the base body)
            - Hair:       400px width, 700px height
            - Shirts:     400px width, 700px height
            - Dresses:    400px width, 700px height
            - Bottoms:    400px width, 700px height (e.g., pants, shorts)
            - Shoes:      400px width, 700px height
            - Jewelry:    400px width, 700px height (e.g., a necklace)

            All assets share the same canvas size to ensure perfect alignment.
            The content within the image (like a shirt) should be positioned
            correctly within that 400x700 transparent frame.
        */

        // --- DATA ---
        const assets = {
            characters: {
                char1: { name: "Alex", img: `https://placehold.co/400x700/f2d5b1/7b3f00?text=Char+1` },
                char2: { name: "Casey", img: `https://placehold.co/400x700/d1a377/7b3f00?text=Char+2` },
            },
            hair: {
                brown_bangs: { name: "Brown Bangs", img: `img/hair/brown-bangs.png?text=Brown Bangs` },
                manbob: { name: "Long Waves", img: `img/hair/manbob.png?text=Man Bob` },
                blonde_dude: { name: "Blonde Dude", img: `img/hair/blonde-dude.png?text=Ponytail` }
            },
            shirts: {
                tee: { name: "T-Shirt", img: `https://placehold.co/400x700/transparent/86efac?text=T-Shirt` },
                hoodie: { name: "Hoodie", img: `https://placehold.co/400x700/transparent/94a3b8?text=Hoodie` },
                tank: { name: "Tank Top", img: `https://placehold.co/400x700/transparent/f9a8d4?text=Tank` },
            },
            bottoms: {
                shorts: { name: "Shorts", img: `https://placehold.co/400x700/transparent/67e8f9?text=Shorts` },
                skirt: { name: "Skirt", img: `https://placehold.co/400x700/transparent/f472b6?text=Skirt`},
                pants: { name: "Pants", img: `https://placehold.co/400x700/transparent/a78bfa?text=Pants` },
            },
            dresses: {
                sundress: { name: "Sundress", img: `https://placehold.co/400x700/transparent/fde047?text=Sundress` },
                eveningGown: { name: "Gown", img: `https://placehold.co/400x700/transparent/be185d?text=Gown`},
            },
            shoes: {
                boots_with_the_toots: { name: "Boots with the Toots", img: `img/shoes/boots-with-the-toots.png` },
                boots_with_the_shingles: { name: "Boots with the Shingles", img: `img/shoes/boot-with-the-shingles.png` },
                shoesey_rainbow: { name: "Shoesey Rainbow", img: `img/shoes/shoesey-rainbow.png` },
            },
            jewelry: {
                necklace: { name: "Necklace", img: `https://placehold.co/400x700/transparent/fbbf24?text=Necklace` },
            }
        };

        // --- STATE ---
        let currentLook = {
            character: 'char1', hair: 'brown_bangs', shirts: 'tee', bottoms: 'shorts',
            dresses: null, shoes: 'sneakers', jewelry: null,
        };
        let activeCategory = 'hair'; // Default category to show

        // --- DOM REFERENCES ---
        const characterDisplay = document.getElementById('character-display');
        const characterSelectionContainer = document.getElementById('character-selection');
        const categoryTabsContainer = document.getElementById('category-tabs');
        const itemPanel = document.getElementById('item-panel');
        const shareButton = document.getElementById('share-button');

        // --- RENDER FUNCTIONS ---
        function renderCharacter() {
            characterDisplay.innerHTML = ''; // Clear previous look

            // 1. Render the base character first.
            const baseCharId = currentLook.character;
            const baseCharAsset = assets.characters[baseCharId];
            if (baseCharAsset) {
                const baseLayer = document.createElement('img');
                baseLayer.id = 'layer-character';
                baseLayer.className = 'absolute inset-0 w-full h-full';
                baseLayer.src = baseCharAsset.img;
                baseLayer.alt = baseCharAsset.name;
                characterDisplay.appendChild(baseLayer);
            }

            // 2. Render clothing and accessories on top.
            const renderOrder = ['shoes', 'bottoms', 'shirts', 'dresses', 'jewelry', 'hair'];
            renderOrder.forEach(category => {
                const itemId = currentLook[category];
                if (itemId) {
                    const asset = assets[category]?.[itemId];
                    if (asset?.img) {
                        const layer = document.createElement('img');
                        layer.id = `layer-${category}`;
                        layer.className = 'absolute inset-0 w-full h-full';
                        layer.src = asset.img;
                        layer.alt = asset.name;
                        characterDisplay.appendChild(layer);
                    }
                }
            });
        }

        function createCharacterSelectors() {
            let buttonsHTML = '';
            for (const key in assets.characters) {
                const character = assets.characters[key];
                buttonsHTML += `
                    <button class="character-selector rounded-full p-1 transition-transform transform hover:scale-110" data-char="${key}">
                        <div class="w-12 h-12 bg-pink-200 rounded-full overflow-hidden pointer-events-none">
                           <img src="${character.img}" alt="${character.name}">
                        </div>
                    </button>
                `;
            }
            characterSelectionContainer.innerHTML = buttonsHTML;
        }

        function createCategoryTabs() {
            const categoryOrder = { hair: '✨', dresses: '👗', shirts: '👕', bottoms: '👖', shoes: '👟', jewelry: '💍' };
            let tabsHTML = '';
            for (const key in categoryOrder) {
                tabsHTML += `
                    <button class="category-tab px-4 py-2 rounded-full font-semibold text-pink-700 bg-pink-100 transition-all" data-category="${key}">
                        ${categoryOrder[key]} ${key.charAt(0).toUpperCase() + key.slice(1)}
                    </button>
                `;
            }
            categoryTabsContainer.innerHTML = tabsHTML;
        }

        function renderWardrobeItems(categoryKey) {
            const items = assets[categoryKey];
            let itemsHTML = '<div class="flex flex-wrap gap-4">';

            // The "None" button is created first and for every category.
            itemsHTML += `
                <button class="wardrobe-item w-24 h-24 bg-slate-100 rounded-xl shadow-md p-2 flex items-center justify-center text-slate-500 font-bold text-lg transition-transform transform hover:scale-105"
                        data-category="${categoryKey}" data-item="null">
                    None
                </button>
            `;

            for (const key in items) {
                itemsHTML += `
                    <button class="wardrobe-item w-24 h-24 bg-pink-100 rounded-xl shadow-md p-2 flex items-center justify-center transition-transform transform hover:scale-105"
                            data-category="${categoryKey}" data-item="${key}">
                        <div class="w-full h-full pointer-events-none">
                            <img src="${items[key].img}" alt="${items[key].name}">
                        </div>
                    </button>
                `;
            }

            itemsHTML += '</div>';
            itemPanel.innerHTML = itemsHTML;
            updateActiveButtons();
        }

        function updateActiveButtons() {
            // Highlight active character
            document.querySelectorAll('.character-selector').forEach(btn => {
                btn.classList.toggle('active', currentLook.character === btn.dataset.char);
            });
            // Highlight active category tab
            document.querySelectorAll('.category-tab').forEach(btn => {
                btn.classList.toggle('active', activeCategory === btn.dataset.category);
            });
            // Highlight active wardrobe item in the current panel
            document.querySelectorAll('.wardrobe-item').forEach(btn => {
                const { category, item } = btn.dataset;
                const isActive = currentLook[category] === item || (currentLook[category] === null && item === 'null');
                btn.classList.toggle('active', isActive);
            });
        }

        function updateURL() {
            const params = new URLSearchParams();
            for (const key in currentLook) {
                // Store null as the string 'null' so it's not omitted from the URL
                params.set(key, currentLook[key] === null ? 'null' : currentLook[key]);
            }
            const newUrl = `${window.location.pathname}?${params.toString()}`;
            // Update the URL in the browser bar without reloading the page
            window.history.pushState({ path: newUrl }, '', newUrl);
        }

        function loadLookFromURL() {
            const params = new URLSearchParams(window.location.search);
            if (params.toString() === '') return; // No params, do nothing.

            for (const [key, value] of params.entries()) {
                if (currentLook.hasOwnProperty(key)) {
                    // Convert the string 'null' back to a true null value
                    const finalValue = value === 'null' ? null : value;

                    // Check if the asset exists before setting it to prevent errors
                    if (key === 'character' && assets.characters[finalValue]) {
                         currentLook[key] = finalValue;
                    } else if (assets[key] && (assets[key][finalValue] || finalValue === null)) {
                         currentLook[key] = finalValue;
                    }
                }
            }
        }

        function handleShareClick() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const originalText = shareButton.innerHTML;
                shareButton.innerHTML = '✅ Copied!';
                shareButton.disabled = true;
                setTimeout(() => {
                    shareButton.innerHTML = originalText;
                    shareButton.disabled = false;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy URL: ', err);
                alert('Could not copy URL to clipboard.');
            });
        }

        // --- EVENT HANDLERS ---
        function handleCategoryTabClick(event) {
            const button = event.target.closest('.category-tab');
            if (!button) return;
            activeCategory = button.dataset.category;
            renderWardrobeItems(activeCategory);
            updateActiveButtons();
        }

        function handleWardrobeClick(event) {
            const button = event.target.closest('.wardrobe-item');
            if (!button) return;

            const { category, item } = button.dataset;
            const newItem = item === 'null' ? null : item;
            currentLook[category] = newItem;

            if (category === 'dresses' && newItem !== null) {
                currentLook.shirts = null;
                currentLook.bottoms = null;
            }
            if ((category === 'shirts' || category === 'bottoms') && newItem !== null) {
                currentLook.dresses = null;
            }

            renderCharacter();
            updateActiveButtons();
            updateURL(); // Update URL on change
        }

        function handleCharacterClick(event) {
             const button = event.target.closest('.character-selector');
             if (!button) return;
             currentLook.character = button.dataset.char;
             renderCharacter();
             updateActiveButtons();
             updateURL(); // Update URL on change
        }

        // --- INITIALIZATION ---
        function init() {
            loadLookFromURL(); // Load state from URL first

            createCharacterSelectors();
            createCategoryTabs();
            renderWardrobeItems(activeCategory); // Render initial category

            // Add event listeners
            categoryTabsContainer.addEventListener('click', handleCategoryTabClick);
            itemPanel.addEventListener('click', handleWardrobeClick);
            characterSelectionContainer.addEventListener('click', handleCharacterClick);
            shareButton.addEventListener('click', handleShareClick); // Listener for share button

            // Initial render based on state (either default or from URL)
            renderCharacter();
            updateActiveButtons();
            updateURL(); // Set the initial URL
        }

        window.onload = init;
    </script>
</body>
</html>
