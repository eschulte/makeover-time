<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Makeover Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #fce4ec; /* Light pink background */
        }
        .title-font {
            font-family: 'Pacifico', cursive;
        }
        /* Custom scrollbar for a more playful look */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #fde6f0;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #f48fb1; /* Brighter pink */
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #f06292;
        }
        /* Custom padding fix */
        .pr-2 {
            padding-right: 0.5rem;
        }
        /* Style for the active/selected item */
        .wardrobe-item.active, .character-selector.active, #eraser-btn.active {
            box-shadow: 0 0 0 4px #ec4899; /* Pink-500 */
            transform: scale(1.05);
        }
        .category-tab.active {
            background-color: #ec4899; /* pink-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Transition for smooth character and clothing changes */
        #character-display > div {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Ensure images fit their containers properly */
        .wardrobe-item img, .character-selector img, #character-display img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        /* Styles for the drawing canvas */
        #canvas-wrapper {
            aspect-ratio: 400 / 700;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            touch-action: none; /* Prevents scrolling on canvas on mobile */
        }
        #drawing-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 max-w-7xl">
        <header class="text-center my-6">
            <h1 class="title-font text-5xl md:text-7xl text-pink-500">Makeover Time</h1>
            <p class="text-pink-700 mt-2 text-lg">Choose a character and create the perfect look!</p>
            <div class="mt-4">
                <button id="share-button" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-pink-600 transition-all transform hover:scale-105">
                    ✨ Share Look!
                </button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 flex flex-col items-center">
                <div id="character-selection" class="mb-4 flex gap-3 bg-white/70 p-2 rounded-full shadow-md">
                </div>
                <div id="character-display-container" class="relative w-64 h-[450px] md:w-80 md:h-[560px] bg-white rounded-3xl shadow-2xl overflow-hidden flex items-center justify-center">
                    <div class="absolute inset-0 bg-gradient-to-br from-pink-100 to-purple-100"></div>
                     <div id="character-display" class="relative w-full h-full"></div>
                </div>
            </div>

            <div id="right-panel" class="lg:col-span-2 bg-white/80 backdrop-blur-sm p-6 rounded-3xl shadow-lg flex flex-col">
                <div id="wardrobe-container" class="flex flex-col flex-grow">
                    <div id="category-tabs" class="flex flex-wrap gap-2 border-b-2 border-pink-200 pb-4 mb-4">
                    </div>
                    <div id="item-panel" class="flex-grow custom-scrollbar overflow-y-auto pr-2">
                    </div>
                </div>

                <div id="drawing-container" class="hidden flex-col flex-grow">
                    <div class="flex flex-wrap items-center gap-y-2 gap-x-4 border-b-2 border-pink-200 pb-4 mb-4">
                        <button id="back-to-wardrobe-btn" class="bg-slate-200 text-slate-700 font-bold py-2 px-4 rounded-full shadow-md hover:bg-slate-300 transition-all text-sm">← Back</button>
                        <div>
                            <label for="color-picker" class="font-semibold text-pink-700 text-sm">Color</label>
                            <input type="color" id="color-picker" value="#ec4899" class="w-9 h-9 p-0.5 bg-white border-2 border-pink-200 rounded-md cursor-pointer align-middle">
                        </div>
                        <div class="flex-grow min-w-[120px]">
                            <label for="brush-size" class="font-semibold text-pink-700 text-sm">Size: <span id="brush-size-value">10</span></label>
                            <input type="range" id="brush-size" min="1" max="50" value="10" class="w-full align-middle h-2 bg-pink-100 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <button id="eraser-btn" class="bg-pink-100 text-pink-700 font-bold py-2 px-4 rounded-full shadow-md hover:bg-pink-200 transition-all text-sm">Eraser</button>
                        <button id="clear-canvas-btn" class="bg-red-200 text-red-700 font-bold py-2 px-4 rounded-full shadow-md hover:bg-red-300 transition-all text-sm">Clear</button>
                    </div>

                    <div class="flex-grow flex items-center justify-center relative bg-slate-100 rounded-2xl">
                         <div id="canvas-wrapper" class="relative" style="width: 400px; height: 700px; max-width: 100%; max-height: 100%;">
                             <div id="character-guide" class="absolute inset-0 bg-no-repeat bg-center bg-contain opacity-40 pointer-events-none"></div>
                            <canvas id="drawing-canvas" width="400" height="700" class="absolute top-0 left-0"></canvas>
                        </div>
                    </div>

                    <div class="mt-4 flex flex-wrap items-center gap-y-2 gap-x-4">
                        <input type="text" id="item-name-input" placeholder="Name your creation..." class="flex-grow p-2 border-2 border-pink-200 rounded-lg focus:ring-pink-500 focus:border-pink-500 min-w-[150px]">
                        <select id="item-category-select" class="p-2 border-2 border-pink-200 rounded-lg focus:ring-pink-500 focus:border-pink-500">
                        </select>
                        <button id="save-drawing-btn" class="bg-pink-500 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:bg-pink-600 transition-all">
                            ✨ Save Item
                        </button>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <script>
        // --- IMAGE ASSET GUIDELINES ---
        /* ... (guidelines remain the same) ... */

        // --- DATA ---
        const assets = {
            characters: {
                char1: { name: "Alex", img: `https://placehold.co/400x700/f2d5b1/7b3f00?text=Char+1` },
                char2: { name: "Arlo", img: `img/characters/arlo.png?text=Arlo` },
                // char2: { name: "Casey", img: `https://placehold.co/400x700/d1a377/7b3f00?text=Char+2` },
            },
            hair: {
                blonde_bangs: { name: "Blonde Bangs", img: `img/hair/blonde-bangs.png` },
                blonde_dude:  { name: "Blonde Dude", img: `img/hair/blonde-dude.png` },
                blonde_long_bangs:  { name: "Blonde Long Bangs", img: `img/hair/blonde-long-bangs.png` },
                blonde_long:  { name: "Blonde Long", img: `img/hair/blonde-long.png` },
                brown_bangs:  { name: "Brown Bangs", img: `img/hair/brown-bangs.png` },
                brunette_long_bangs:  { name: "Brunette Long Bangs", img: `img/hair/brunette-long-bangs.png` },
                brunette_w_money_pieces:  { name: "Brunette W Money Pieces", img: `img/hair/brunette-w-money-pieces.png` },
                brunette_w_tips_2:  { name: "Brunette W Tips 2", img: `img/hair/brunette-w-tips-2.png` },
                brunette_w_tips_and_bangs_tips:  { name: "Brunette W Tips And Bangs Tips", img: `img/hair/brunette-w-tips-and-bangs-tips.png` },
                brunette_w_tips:  { name: "Brunette W Tips", img: `img/hair/brunette-w-tips.png` },
                Manbob:  { Name: "Manbob", img: `img/hair/manbob.png` },
                Mohawk:  { Name: "Mohawk", img: `img/hair/mohawk.png` },
                pink_long_bangs:  { name: "Pink Long Bangs", img: `img/hair/pink-long-bangs.png` },
            },
            shirts: {
                tee: { name: "T-Shirt", img: `https://placehold.co/400x700/transparent/86efac?text=T-Shirt` },
            },
            bottoms: {
                shorts: { name: "Shorts", img: `https://placehold.co/400x700/transparent/67e8f9?text=Shorts` },
            },
            dresses: {
                sundress: { name: "Sundress", img: `https://placehold.co/400x700/transparent/fde047?text=Sundress` },
            },
            shoes: {
                boots_with_the_toots: { name: "Boots with the Toots", img: `img/shoes/boots-with-the-toots.png` },
                boots_with_the_shingles: { name: "Boots with the Shingles", img: `img/shoes/boot-with-the-shingles.png` },
                shoesey_rainbow: { name: "Shoesey Rainbow", img: `img/shoes/shoesey-rainbow.png` },
            },
            jewelry: {
                necklace: { name: "Necklace", img: `https://placehold.co/400x700/transparent/fbbf24?text=Necklace` },
            }
        };

        // --- STATE ---
        let currentLook = {
            character: 'char1', hair: 'brown_bangs', shirts: 'tee', bottoms: 'shorts',
            dresses: null, shoes: 'sneakers', jewelry: null,
        };
        let activeCategory = 'hair';
        let isDrawing = false;
        let isErasing = false;

        // --- DOM REFERENCES ---
        const characterDisplay = document.getElementById('character-display');
        const characterSelectionContainer = document.getElementById('character-selection');
        const categoryTabsContainer = document.getElementById('category-tabs');
        const itemPanel = document.getElementById('item-panel');
        const shareButton = document.getElementById('share-button');

        // New Drawing Mode DOM References
        const wardrobeContainer = document.getElementById('wardrobe-container');
        const drawingContainer = document.getElementById('drawing-container');
        const backToWardrobeBtn = document.getElementById('back-to-wardrobe-btn');
        const drawingCanvas = document.getElementById('drawing-canvas');
        const characterGuide = document.getElementById('character-guide');
        const colorPicker = document.getElementById('color-picker');
        const brushSizeSlider = document.getElementById('brush-size');
        const brushSizeValue = document.getElementById('brush-size-value');
        const eraserBtn = document.getElementById('eraser-btn');
        const clearCanvasBtn = document.getElementById('clear-canvas-btn');
        const saveDrawingBtn = document.getElementById('save-drawing-btn');
        const itemNameInput = document.getElementById('item-name-input');
        const itemCategorySelect = document.getElementById('item-category-select');
        const ctx = drawingCanvas.getContext('2d');

        // --- RENDER FUNCTIONS ---
        function renderCharacter() { /* ... (function is unchanged) ... */
             characterDisplay.innerHTML = '';
             const baseCharId = currentLook.character;
             const baseCharAsset = assets.characters[baseCharId];
             if (baseCharAsset) {
                 const baseLayer = document.createElement('img');
                 baseLayer.id = 'layer-character';
                 baseLayer.className = 'absolute inset-0 w-full h-full';
                 baseLayer.src = baseCharAsset.img;
                 baseLayer.alt = baseCharAsset.name;
                 characterDisplay.appendChild(baseLayer);
             }
             const renderOrder = ['shoes', 'bottoms', 'shirts', 'dresses', 'jewelry', 'hair'];
             renderOrder.forEach(category => {
                 const itemId = currentLook[category];
                 if (itemId) {
                     const asset = assets[category]?.[itemId];
                     if (asset?.img) {
                         const layer = document.createElement('img');
                         layer.id = `layer-${category}`;
                         layer.className = 'absolute inset-0 w-full h-full';
                         layer.src = asset.img;
                         layer.alt = asset.name;
                         characterDisplay.appendChild(layer);
                     }
                 }
             });
        }
        function createCharacterSelectors() { /* ... (function is unchanged) ... */
             let buttonsHTML = '';
             for (const key in assets.characters) {
                 const character = assets.characters[key];
                 buttonsHTML += `
                     <button class="character-selector rounded-full p-1 transition-transform transform hover:scale-110" data-char="${key}">
                         <div class="w-12 h-12 bg-pink-200 rounded-full overflow-hidden pointer-events-none">
                             <img src="${character.img}" alt="${character.name}">
                         </div>
                     </button>
                 `;
             }
             characterSelectionContainer.innerHTML = buttonsHTML;
        }

        function createCategoryTabs() {
            const categoryOrder = { hair: '✨', dresses: '👗', shirts: '👕', bottoms: '👖', shoes: '👟', jewelry: '💍' };
            let tabsHTML = '';
            for (const key in categoryOrder) {
                tabsHTML += `
                    <button class="category-tab px-4 py-2 rounded-full font-semibold text-pink-700 bg-pink-100 transition-all" data-category="${key}">
                        ${categoryOrder[key]} ${key.charAt(0).toUpperCase() + key.slice(1)}
                    </button>
                `;
            }
            // Add the "Draw Your Own" button
            tabsHTML += `<button id="draw-mode-btn" class="category-tab px-4 py-2 rounded-full font-semibold text-purple-700 bg-purple-100 transition-all" data-category="draw">🎨 Draw New</button>`;
            categoryTabsContainer.innerHTML = tabsHTML;
        }

        function renderWardrobeItems(categoryKey) { /* ... (function is unchanged) ... */
             const items = assets[categoryKey];
             let itemsHTML = '<div class="flex flex-wrap gap-4">';
             itemsHTML += `
                 <button class="wardrobe-item w-24 h-24 bg-slate-100 rounded-xl shadow-md p-2 flex items-center justify-center text-slate-500 font-bold text-lg transition-transform transform hover:scale-105"
                         data-category="${categoryKey}" data-item="null">
                     None
                 </button>
             `;
             for (const key in items) {
                 itemsHTML += `
                     <button class="wardrobe-item w-24 h-24 bg-pink-100 rounded-xl shadow-md p-2 flex items-center justify-center transition-transform transform hover:scale-105"
                             data-category="${categoryKey}" data-item="${key}">
                         <div class="w-full h-full pointer-events-none">
                             <img src="${items[key].img}" alt="${items[key].name}">
                         </div>
                     </button>
                 `;
             }
             itemsHTML += '</div>';
             itemPanel.innerHTML = itemsHTML;
             updateActiveButtons();
        }
        function updateActiveButtons() { /* ... (function is unchanged) ... */
             document.querySelectorAll('.character-selector').forEach(btn => {
                 btn.classList.toggle('active', currentLook.character === btn.dataset.char);
             });
             document.querySelectorAll('.category-tab').forEach(btn => {
                const isDrawButton = btn.dataset.category === 'draw';
                if (!isDrawButton) {
                    btn.classList.toggle('active', activeCategory === btn.dataset.category && wardrobeContainer.offsetParent !== null);
                }
             });
             document.querySelectorAll('.wardrobe-item').forEach(btn => {
                 const { category, item } = btn.dataset;
                 const isActive = currentLook[category] === item || (currentLook[category] === null && item === 'null');
                 btn.classList.toggle('active', isActive);
             });
        }

        // --- NEW DRAWING MODE FUNCTIONS ---

        function showView(viewName) {
            if (viewName === 'drawing') {
                wardrobeContainer.classList.add('hidden');
                drawingContainer.classList.remove('hidden');
                drawingContainer.classList.add('flex');
                document.getElementById('draw-mode-btn').classList.add('active');


                // Set character guide background
                const charImg = assets.characters[currentLook.character].img;
                characterGuide.style.backgroundImage = `url(${charImg})`;
            } else { // 'wardrobe'
                wardrobeContainer.classList.remove('hidden');
                drawingContainer.classList.add('hidden');
                drawingContainer.classList.remove('flex');
                document.getElementById('draw-mode-btn').classList.remove('active');
            }
             updateActiveButtons();
        }

        function populateCategorySelect() {
            const wearableCategories = ['hair', 'shirts', 'bottoms', 'dresses', 'shoes', 'jewelry'];
            itemCategorySelect.innerHTML = wearableCategories.map(cat =>
                `<option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`
            ).join('');
        }

        function getEventPosition(e) {
            const rect = drawingCanvas.getBoundingClientRect();
            const scaleX = drawingCanvas.width / rect.width;
            const scaleY = drawingCanvas.height / rect.height;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            const { x, y } = getEventPosition(e);
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const { x, y } = getEventPosition(e);
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.closePath();
        }

        function setupCanvas() {
            ctx.strokeStyle = colorPicker.value;
            ctx.lineWidth = brushSizeSlider.value;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Desktop events
            drawingCanvas.addEventListener('mousedown', startDrawing);
            drawingCanvas.addEventListener('mousemove', draw);
            drawingCanvas.addEventListener('mouseup', stopDrawing);
            drawingCanvas.addEventListener('mouseleave', stopDrawing);

            // Mobile events
            drawingCanvas.addEventListener('touchstart', startDrawing);
            drawingCanvas.addEventListener('touchmove', draw);
            drawingCanvas.addEventListener('touchend', stopDrawing);
        }

        function handleSaveDrawing() {
            const name = itemNameInput.value.trim();
            const category = itemCategorySelect.value;

            if (!name) {
                alert('Please name your creation!');
                return;
            }

            const id = `custom_${Date.now()}`;
            const imgDataUrl = drawingCanvas.toDataURL('image/png');

            if (!assets[category]) assets[category] = {};
            assets[category][id] = { name: name, img: imgDataUrl };

            // Reset drawing board
            itemNameInput.value = '';
            ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);

            // Switch back and show the new item
            activeCategory = category;
            showView('wardrobe');
            renderWardrobeItems(category);
        }


        // --- UTILITY & EVENT HANDLERS ---
        function updateURL() { /* ... (function is unchanged) ... */
             const params = new URLSearchParams();
             for (const key in currentLook) {
                 params.set(key, currentLook[key] === null ? 'null' : currentLook[key]);
             }
             const newUrl = `${window.location.pathname}?${params.toString()}`;
             window.history.pushState({ path: newUrl }, '', newUrl);
        }
        function loadLookFromURL() { /* ... (function is unchanged) ... */
             const params = new URLSearchParams(window.location.search);
             if (params.toString() === '') return;
             for (const [key, value] of params.entries()) {
                 if (currentLook.hasOwnProperty(key)) {
                     const finalValue = value === 'null' ? null : value;
                     if (key === 'character' && assets.characters[finalValue]) {
                          currentLook[key] = finalValue;
                     } else if (assets[key] && (assets[key][finalValue] || finalValue === null)) {
                          currentLook[key] = finalValue;
                     }
                 }
             }
        }
        function handleShareClick() { /* ... (function is unchanged) ... */
             navigator.clipboard.writeText(window.location.href).then(() => {
                 const originalText = shareButton.innerHTML;
                 shareButton.innerHTML = '✅ Copied!';
                 shareButton.disabled = true;
                 setTimeout(() => {
                     shareButton.innerHTML = originalText;
                     shareButton.disabled = false;
                 }, 2000);
             }).catch(err => {
                 console.error('Failed to copy URL: ', err);
                 alert('Could not copy URL to clipboard.');
             });
        }
        function handleCategoryTabClick(event) {
            const button = event.target.closest('.category-tab');
            if (!button) return;

            const category = button.dataset.category;
            if (category === 'draw') {
                showView('drawing');
            } else {
                showView('wardrobe');
                activeCategory = category;
                renderWardrobeItems(activeCategory);
            }
            updateActiveButtons();
        }
        function handleWardrobeClick(event) { /* ... (function is unchanged) ... */
             const button = event.target.closest('.wardrobe-item');
             if (!button) return;
             const { category, item } = button.dataset;
             const newItem = item === 'null' ? null : item;
             currentLook[category] = newItem;
             if (category === 'dresses' && newItem !== null) {
                 currentLook.shirts = null;
                 currentLook.bottoms = null;
             }
             if ((category === 'shirts' || category === 'bottoms') && newItem !== null) {
                 currentLook.dresses = null;
             }
             renderCharacter();
             updateActiveButtons();
             updateURL();
        }
        function handleCharacterClick(event) { /* ... (function is unchanged) ... */
              const button = event.target.closest('.character-selector');
               if (!button) return;
               currentLook.character = button.dataset.char;
               renderCharacter();
               updateActiveButtons();
               updateURL();
        }

        // --- INITIALIZATION ---
        function init() {
            loadLookFromURL();

            createCharacterSelectors();
            createCategoryTabs();
            renderWardrobeItems(activeCategory);

            // Setup new drawing feature
            setupCanvas();
            populateCategorySelect();

            // Add event listeners
            categoryTabsContainer.addEventListener('click', handleCategoryTabClick);
            itemPanel.addEventListener('click', handleWardrobeClick);
            characterSelectionContainer.addEventListener('click', handleCharacterClick);
            shareButton.addEventListener('click', handleShareClick);

            // New Drawing Listeners
            backToWardrobeBtn.addEventListener('click', () => showView('wardrobe'));
            saveDrawingBtn.addEventListener('click', handleSaveDrawing);
            clearCanvasBtn.addEventListener('click', () => ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height));
            colorPicker.addEventListener('input', e => {
                 ctx.strokeStyle = e.target.value;
                 if (isErasing) { // Switch back to brush if a new color is picked
                     isErasing = false;
                     eraserBtn.classList.remove('active');
                     ctx.globalCompositeOperation = 'source-over';
                 }
            });
            brushSizeSlider.addEventListener('input', e => {
                 brushSizeValue.textContent = e.target.value;
                 ctx.lineWidth = e.target.value;
            });
            eraserBtn.addEventListener('click', () => {
                 isErasing = !isErasing;
                 eraserBtn.classList.toggle('active', isErasing);
                 ctx.globalCompositeOperation = isErasing ? 'destination-out' : 'source-over';
            });


            // Initial render
            renderCharacter();
            updateActiveButtons();
            updateURL();
        }

        window.onload = init;
    </script>
</body>
</html>
